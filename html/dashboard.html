<!DOCTYPE html>
<html lang="ko">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="Content-Script-Type" content="text/javascript">
    <meta http-equiv="Content-Style-Type" content="text/css">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="Generator" content="KIC">
    <meta name="Author" content="코리아인스트루먼트(주) 교정관리 시스템">
    <meta name="Keywords" content="코리아인스트루먼트(주) 교정관리 시스템">
    <meta name="Description" content="코리아인스트루먼트(주) 교정관리 시스템">
    <title>코리아인스트루먼트(주) 교정관리 시스템</title>
    <script src="https://kit.fontawesome.com/8f18490998.js" crossorigin="anonymous" ></script>
    <script src="../assets/js/jquery-3.1.1.min.js"></script>
    <script src="../assets/js/jquery-ui.min.js"></script>
    <script src="../assets/js/swiper.min.js"></script>
    <script src="../assets/js/main.js" defer></script>

    <link rel="stylesheet" href="../assets/css/jquery-ui.min.css">
    <link rel="stylesheet" href="../assets/css/swiper-bundle.min.css">
    <link rel="stylesheet" href="../assets/css/datepicker.css">
    <link rel="stylesheet" href="../assets/css/common.min.css">


     <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
    <div id="skip-nav">
        <a href="#container"></a>
    </div>
    <div id="wrap">
        <!-- header -->
        <header class="header">
            <h1 class="logo"><a href=""><img src="../assets/images/common/logo.svg" alt=""></a></h1>
        </header>
        <!--// header -->
        <!-- sidenav -->
        <aside class="sidenav">
            <div class="sidenav_top">
                <div>
                    <div class="user_name"><b>김영술</b> (okkim)</div>
                    <div class="co_name">코리아인스트루먼트 서울본사 (IT 서비스개발실)</div>
                </div>
                <button type="button" class="btn_nav_close" aria-label="close navigation"></button>
            </div>
            <ul class="nav">
                <li class="nav_item">
                    <a href="" class="btn_dep1"><i class="ico_dep1 ty_menu1"></i>전체 조회</a>
                </li>
                <li class="nav_item">
                    <a href="" class="btn_dep1 "><i class="ico_dep1 ty_menu2"></i>업체 조회</a>              
                </li>
                <li class="nav_item">
                    <a href="" class="btn_dep1"><i class="ico_dep1 ty_menu3"></i>견적 조회</a>          
                </li>
                <li class="nav_item">
                    <a href="" class="btn_dep1"><i class="ico_dep1 ty_menu4"></i>일정 조회</a>               
                </li>
                <li class="nav_item">
                    <a href="" class="btn_dep1"><i class="ico_dep1 ty_menu5"></i>교정 수수료</a>                
                </li>
                <li class="nav_item">
                    <a href="" class="btn_dep1"><i class="ico_dep1 ty_menu6"></i>예약번호</a>               
                </li>
            </ul>
            <div class="sidenav_bot">
                <button type="button" class="f_btn ty_mid _midGrey w_100">로그아웃 <i class="fa-solid fa-right-from-bracket"></i></button>
            </div>
        </aside>
        <!--// sidenav -->
        <!--container-->
        <main id="container" class="container">
            <div id="contents" class="contents">
                <div class="dashboard">
                    <div class="dashboard_user">
                        <div class="dashboard_user_txt">
                            <p class="fwM fc_midGrey">안녕하세요.</p>
                            <p class="fwM">박보영(코리아인스트루먼트 서울본사)님</p>
                        </div>
                        <button type="button" class="f_btn ty_small _key4 pd10">로그아웃 <i class="fa-solid fa-right-from-bracket"></i></button>
                    </div>
                    <div class="dashboard_sec">
                        <div class="dashboard_sec_top d_flex">
                            <h2 class="tit">교정현황</h2>
                            <span class="date ml_auto self_bot fz_3 fc_midGrey fwM">기준시간: 2025.10.14 13:15</span>
                        </div>
                        <div class="cal_state">
                            <div class="cal_state_item">
                                <div class="tit">
                                    <span class="tit_ico bg_key"><i class="fa-solid fa-scale-balanced"></i></span>
                                    교정 대기
                                </div>
                                <div class="cal_state_count mt4">
                                    <strong class="fz_9">772</strong> <span class="fz_5">건</span>
                                    <div class="d_flex _gap5 fwM ai_c fz_3 mt4">
                                        <span class="fc_key">사내 283</span>
                                        <span class="bar bg_lightGrey2"></span>
                                        <span class="fc_red">현장 439</span>
                                    </div>
                                </div>

                            </div>
                            <div class="cal_state_item">
                                <div class="tit">
                                    <span class="tit_ico bg_red"><i class="fa-solid fa-scale-balanced"></i></span>
                                    교정 진행
                                </div>
                                <div class="cal_state_count mt4">
                                    <strong class="fz_9">772</strong> <span class="fz_5">건</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="dashboard_sec">
                        <div class="dashboard_sec_top d_flex">
                            <h2 class="tit">월별 교정 추이</h2>
                            <span class="date ml_auto self_bot fz_3 fc_midGrey fwM">(최근 6개월)</span>
                        </div>
                        <div class="chart_box">
                            <div class="chart" id="columnchart"></div>
                        </div>
                        <script>
                            google.charts.load('current', {
                                callback: function () {
                                    drawChart();
                                    $(window).on('resize', drawChart);
                                },
                                packages: ['corechart']
                            });
                            google.charts.setOnLoadCallback(drawChart);
                            function drawChart() {
                                 // 🔧 월별 목표/달성 (2025-09-10 새 버전)
                                    const columnRows = [
                                       
                                        { label: '24년 1월',  goal: 1400, achieved: 980  },
                                        { label: '24년 1월',  goal: 1600, achieved: 1600 },
                                        { label: '24년 1월',  goal: 1700, achieved: 1430 },
                                        { label: '24년 1월', goal: 1500, achieved: 1540 }, 
                                        { label: '24년 1월', goal: 1600, achieved: 940  },
                                        { label: '24년 1월', goal: 1700, achieved: 1900 },
                                        /* 
                                            goal : 목표 수량
                                            achieved : 달성 수량
                                        */ 

                                    ];

                                    const columnMaxGoal = Math.max(...columnRows.map(r => r.goal));
                                    const columnMaxAch  = Math.max(...columnRows.map(r => r.achieved));
                                    const columnYMax    = Math.max(columnMaxGoal, columnMaxAch);

                                    // DataTable 정의
                                    const columnData = new google.visualization.DataTable();
                                    columnData.addColumn('string', '월');

                                    // 시리즈 0: 달성수량 + annotation + tooltip
                                    columnData.addColumn('number', '달성수량');
                                    columnData.addColumn({ type: 'string', role: 'annotation' });
                                    columnData.addColumn({ type: 'string', role: 'tooltip', p: { html: true } });

                                    // 시리즈 1: 남은부분 + tooltip
                                    columnData.addColumn('number', '미달수량');
                                    columnData.addColumn({ type: 'string', role: 'tooltip', p: { html: true } });

                                    // 시리즈 2: 초과달성 + tooltip
                                    columnData.addColumn('number', '초과달성');
                                    columnData.addColumn({ type: 'string', role: 'tooltip', p: { html: true } });

                                    // 행 추가
                                    columnRows.forEach(r => {
                                        const goal = r.goal;
                                        const ach  = r.achieved;

                                        const achievedWithinGoal = Math.min(ach, goal);
                                        const remain = Math.max(goal - ach, 0);
                                        const extra  = ach > goal ? (ach - goal) : null;  // 0 대신 null → 선 안보임
                                        const pct    = Math.round((ach / goal) * 100);

                                        const ann = `${ach.toLocaleString()} (${pct}%)`;

                                        // 공통 HTML 툴팁(모든 시리즈에 동일하게 사용)
                                        const tooltipHTML = `
                                            <div style="padding:8px 8px; line-height:1.5;">
                                            <div style="font-weight:600; margin-bottom:4px;">${r.label}</div>
                                            <div>목표:<b>${goal.toLocaleString()}</b></div>
                                            <div>달성:<b>${ach.toLocaleString()}</b></div>
                                            <div>미달:<b>${remain.toLocaleString()}</b></div>
                                            <div>초과:<b>${extra ? extra.toLocaleString() : 0}</b></div>
                                            <div>달성률:<b>${pct}%</b></div>
                                            </div>
                                        `.trim();

                                        columnData.addRow([
                                            r.label,
                                            achievedWithinGoal, ann, tooltipHTML,  // 시리즈0
                                            remain,            tooltipHTML,        // 시리즈1
                                            extra,             tooltipHTML         // 시리즈2 (null이면 표시 X)
                                        ]);
                                    });

                                    const columnOptions = {
                                        //title: '월별 교정 현황',
                                        isStacked: true,
                                        //vAxis: {
                                        //    title: '수량',
                                        //    viewWindow: { min: 0, max: columnYMax }
                                        //},
                                        //hAxis: { title: '월' },
                                        series: {
                                            0: { color: '#1199ff' }, // 달성
                                            1: { color: '#d9d9d9' }, // 남은
                                            2: { color: '#ff6678' }  // 초과
                                        },
                                        annotations: {
                                            alwaysOutside: false,
                                            textStyle: { fontSize: 12, color: '#000' }
                                        },
                                        hAxis: {
                                            textStyle: {
                                                fontSize: 11, // 하단 텍스트(레이블) 크기 조정
                                            }
                                        },
                                        chartArea: { right: 10, left: 30, top: 20, bottom: 30 },
                                        legend: { position: 'top' },
                                        tooltip: { isHtml: true, trigger: 'focus' } // HTML 툴팁 활성화
                                    };

                                    const chart = new google.visualization.ColumnChart(document.getElementById('columnchart'));
                                    chart.draw(columnData, columnOptions);

                                    window.addEventListener('resize', () => chart.draw(columnData, columnOptions));
                            }
                        </script>
                    </div>
                </div>
            </div>
        </main>
        <!--//container-->
        <!-- sticky_bot -->
        <div class="sticky_bot">
            <button type="button" aria-label="상단으로 이동" onclick="window.scrollTo(0,0)" class="btn_gotop"></button>
            <ul class="botNav">
                <li class="botNav_item">
                    <a href="" class="botNav_btn">
                        <span class="ico_box ico1"></span>
                        <span class="tit">교정현황</span>
                    </a>
                </li>
                <li class="botNav_item">
                    <a href="" class="botNav_btn">
                        <span class="ico_box ico2"></span>
                        <span class="tit">정산관리</span>
                    </a>
                </li>
                <li class="botNav_item">
                    <a href="" class="botNav_btn">
                        <span class="ico_box ico_home"></span>
                        <span class="tit">홈</span>
                    </a>
                </li>
                <li class="botNav_item">
                    <a href="" class="botNav_btn">
                        <span class="ico_box ico3"></span>
                        <span class="tit">마이페이지</span>
                    </a>
                </li>
                <li class="botNav_item">
                    <button type="button" class="botNav_btn btn_nav_toggle">
                        <span class="ico_box ico4"></span>
                        <span class="tit">메뉴</span>
                    </button>
                </li>
            </ul>
        </div>
        <!-- sticky_bot -->
       
    </div>
</body>
</html>